@using Markdig
@inject IJSRuntime JS

<div @ref="aiDiv" class="mud-typography-body1 ai-message"></div>

@code {
    [Parameter] public string Markdown { get; set; }

    private ElementReference aiDiv;
    private string _lastMarkdown;

    // pipeline with table support, fenced code, lists, footnotes, etc.
    private static readonly MarkdownPipeline _pipeline = new MarkdownPipelineBuilder()
        .UseAdvancedExtensions()
        .Build();

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (Markdown != _lastMarkdown)
        {
            _lastMarkdown = Markdown;
            var html = Markdig.Markdown.ToHtml(Markdown ?? "", _pipeline);
            await JS.InvokeVoidAsync("setInnerHtmlAndRenderMath", aiDiv, html);
        }
    }
}